#! /bin/bash

# This script downloads yt videos to a dir and notifies the user on start and completion
videoDir=$HOME/videos/yt
failedURLs=/tmp/failed_video_urls
opts=''
link=${1}

download () {
  filename=$(/usr/bin/yt-dlp "$link" --print filename --skip-download 2> /dev/null)
  randomVidId=$RANDOM
  notify-send "Downloading: $filename"
  tmux new-session -d -s $randomVidId
  tmux send-keys -t $randomVidId "cd $videoDir; /usr/bin/yt-dlp '$opts' '${link}' && { notify-send "Completed: $filename"; exit; } || { notify-send -u critical "failed: $filename - $randomVidId"; }" Enter;

}

if [[ "$1" =~ "odysee.com" ]]; then
  download & disown
elif [[ "$1" =~ "youtube" ]]; then
  opts='-f bv*[height<2160]+bestaudio'
  download & disown
fi
